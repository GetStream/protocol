---
id: authentication
sidebar_position: 2
slug: /authentication
title: Users & Tokens
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Creating users

Stream Users require only an id to be created. Users can be created with role of user or admin. The role will be set to user if a value is not provided in the request. There are additional properties you can provide to further describe your users.

The `name` and `image` fields are special fields that are supported by client-side SDKs.

You can provide additional data for the user object using the `custom` field.

<Tabs groupId="examples">
<TabItem value="js" label="JavaScript">

```js
const newUser: UserObjectRequest = {
  id: 'userid',
  role: 'user',
  custom: {
    color: 'red',
  },
  name: 'This is a test user',
  image: 'link/to/profile/image',
};
await client.upsertUsers({
  users: {
    [newUser.id]: newUser,
  },
});
```

</TabItem>
</Tabs>

## Updating users

There are two ways to update user objects:

- Updating will replace the existing user object
- Partial update will let you choose which fields you want to chage/unset

<Tabs groupId="examples">
<TabItem value="js" label="JavaScript">

```js
const user: UserObjectRequest = {
  id: 'userid',
  role: 'user',
  custom: {
    color: 'red',
  },
  name: 'This is a test user',
  image: 'link/to/profile/image',
};
client.upsertUsers({
  users: {
    [user.id]: user,
  },
});

// or
client.updateUsersPartial({
  users: [
    {
      id: user.id,
      set: {
        color: 'blue',
      },
      unset: ['name'],
    },
  ],
});
```

</TabItem>
</Tabs>

## Anonymous users

Anonymous users are users that are not authenticated. It's common to use this for watching a livestream or similar where you aren't authenticated. Anonymous users can be connected using client-side SDKs.

## Guest users

Guest users are temporary user accounts. You can use it to temporarily give someone a name and image when joining a call. Guest users can aslso be created cliend-side.

<Tabs groupId="examples">
<TabItem value="js" label="JavaScript">

```js
const guest: UserObjectRequest = {
  id: '<id>',
  name: '<name>',
  custom: {
    color: 'red',
  },
};

const guest = (await client.createGuest({ user: guest })).user;
```

</TabItem>
</Tabs>

## Deactivating and deleting users

While it is usually safer for data retention to deactivate a user, some use cases require completely deleting a user and their data.

Once a user has been deleted, it cannot be un-deleted and the user_id cannot be used again.

```js
client.deactivateUser({
  user_id: '<id>',
});

client.deleteUser({ userId: '<id>' });
```

## User tokens

Stream uses JWT (JSON Web Tokens) to authenticate chat users, enabling them to login. Knowing whether a user is authorized to perform certain actions is managed separately via a role based permissions system. Tokens need to be generated server-side.

You can optionally provide

- expiration time
- issued at date which is necessary if you manually wan to revoke tokens

<Tabs groupId="examples">
<TabItem value="js" label="JavaScript">

```js
const userId = 'john';
// exp and iat are optional
// the token will be valid for 1hour
const exp = Math.round(new Date().getTime() / 1000) + 60 * 60;
const iat = Math.round(new Date().getTime() / 1000);
client.createToken(userId, exp, iat);
```

</TabItem>
<TabItem value="py" label="Python">

```py
import time

# user ID
user_id = 'john'

# exp and iat are optional
# the token will be valid for 1 hour
exp = int(time.time()) + 60 * 60
iat = int(time.time())

client.create_token(user_id = user_id, exp = exp, iat = iat)
```

</TabItem>
</Tabs>

## Call tokens

Call tokens contain a list of call IDs. If a user is authenticated with a call token, they can only access the specified calls.

<Tabs groupId="examples">
<TabItem value="js" label="JavaScript">

```js
const userId = 'john';
// exp and iat are optional
// the token will be valid for 1hour
const exp = Math.round(new Date().getTime() / 1000) + 60 * 60;
const iat = Math.round(new Date().getTime() / 1000);

const call_cids = ['default:call1', 'livestream:call2'];

client.createToken(
  (user_id = user_id),
  (exp = exp),
  (iat = iat),
  (call_cids = call_cids),
);
```

</TabItem>
<TabItem value="py" label="Python">

```py
import time

user_id = 'john'

# exp and iat are optional, token will be valid for 1 hour
exp = int(time.time()) + 60 * 60
iat = int(time.time())

call_cids = ['default:call1', 'livestream:call2']

client.create_token(user_id=user_id, exp, iat, call_cids)
```

</TabItem>
</Tabs>

## Token expiration and token providers

At a high level, the Token Provider is an endpoint on your server that can perform the following sequence of tasks:

1. Receive information about a user from the front end.

2. Validate that user information against your system.

3. Provide a User-ID corresponding to that user to the server client's token creation method.

4. Return that token to the front end.

Tokens can only be safely generated from a server. This means you will need to implement a Token Provider prior to deploying your application to production. To conduct development before implementing a Token Provider, you will need to disable token authentication.

Tokens also should have an expiration date to ensure adequate security. Once a token is expired, cliend-side SDKs can automatically call an endpoint to refresh the token, this endpoint should also be part of the Token Provider implementation.
